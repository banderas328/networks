<?php
$form = $this->form;
$form->setAttribute('action', $this->url('user', array('action' => 'usersearch')));
$form->prepare();

echo $this->form()->openTag($form);
echo $this->formRow($form->get('first_name'));
echo $this->formRow($form->get('second_name'));
echo $this->formRow($form->get('job'));
echo $this->formRow($form->get('country'));
echo $this->formRow($form->get('city'));
echo $this->formRow($form->get('phone'));
echo $this->formSubmit($form->get('submit'));
echo $this->form()->closeTag();
?>
<div id="usersearchdiv">
    <?php
    if ($this->users) {
        if (count($this->users)): ?>
            <ul>
                <?php foreach ($this->users as $item): ?>
                    <?php $vars = get_object_vars($item); ?>

                    <li>
                        <?php echo "<img src='" . $vars['avatar'] . "'>".$vars['first_name']." ".$vars['second_name'] ." <a class='friend_request action_btn' href='/friends/addfriendrequest/".$vars['user_id']."'>Add to Friends</a>";?>
                    </li>
                <?php endforeach; ?>
            </ul>
        <?php endif;
    }
    ?>
    <script type="text/javascript">
        $(function () {
            $('.friend_request').bind('click', function () {
                var url = $(this).attr('href');
                $.ajax({
                    type: "GET",
                    url: url,
                    dataType: "json"
                })
                    .done(function (data) {
                        if (data == 'have') {
                            var have = '<div id="have_request" title="Friend request"><p>request already sent</p></div>';
                            $('body').append(have);
                            $('#have_request').dialog();
                        }
                        else {

                            var have = '<div id="have_request" title="Friend request"><p>request sent</p></div>';
                            $('body').append(have);
                            $('#have_request').dialog();
                        }
                        return false;
                    });
                return false;
            });
        });
    </script>
</div>

